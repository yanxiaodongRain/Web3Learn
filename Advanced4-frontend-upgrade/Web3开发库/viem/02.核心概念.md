# Viem 核心概念解析

## 1. 客户端体系
### 1.1 多链客户端配置
```typescript
// 创建基础客户端
import { createPublicClient, http } from 'viem'
import { sepolia } from 'viem/chains'

const client = createPublicClient({
  chain: sepolia, // 支持 20+ 条链
  transport: http(
    'https://eth-sepolia.g.alchemy.com/v2/YOUR_KEY' // 推荐使用增强型RPC
  ),
  batch?: {
    multicall: true // 启用批量调用
  }
})

// WebSocket 客户端示例
const wsClient = createPublicClient({
  transport: webSocket('wss://eth.llamarpc.com')
})
```

### 1.2 客户端类型
- `PublicClient`: 只读链操作
- `WalletClient`: 签名交易
- `TestClient`: 本地链操作（dev模式）

## 2. 核心 API 模式
### 2.1 区块链数据读取
```typescript
// 获取最新区块
const block = await client.getBlock()
console.log(`Block ${block.number}:`, block.transactions)

// 解析交易详情
const tx = await client.getTransaction({
  hash: '0x...'
})
```

### 2.2 钱包操作
```typescript
import { createWalletClient, custom } from 'viem'

const wallet = createWalletClient({
  transport: custom(window.ethereum!) // 或使用 privateKeyToAccount()
})

// 签名消息
const signature = await wallet.signMessage({
  account: '0x...',
  message: 'Hello Viem'
})

// 发送交易
const hash = await wallet.sendTransaction({
  to: '0x...',
  value: parseEther('0.1')
})
```

## 3. 合约交互模式
### 3.1 类型安全读写
```typescript
const abi = [...] as const // 使用 const 断言保证类型推断

// 读取合约
const balance = await client.readContract({
  address: '0x...',
  abi,
  functionName: 'balanceOf',
  args: ['0x...']
})

// 写入合约
const { hash } = await wallet.writeContract({
  address: '0x...',
  abi,
  functionName: 'transfer',
  args: ['0x...', 100n]
})
```

### 3.2 事件监听
```typescript
const unwatch = client.watchContractEvent({
  address: '0x...',
  abi,
  eventName: 'Transfer',
  onLogs: logs => {
    logs.forEach(log => 
      console.log(`${log.args.from} -> ${log.args.to}: ${log.args.value}`)
    )
  },
  onError: error => console.error('Event error:', error)
})

// 停止监听
unwatch()
```

## 关键要点
1. **类型安全**：所有方法都有严格的TS类型校验
2. **链抽象**：统一API支持多链操作
3. **响应式设计**：内置事件监听和状态管理
4. **模块化传输层**：支持HTTP/WebSocket/IPC多种连接方式

实操顺序：
1. 配置多链客户端 → 2. 基础数据查询 → 3. 交易签名 → 4. 合约交互 → 5. 事件监听
```
