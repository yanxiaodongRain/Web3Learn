### 1 ▫️ 组件设计
```typescript:/src/web3-wallet/core.ts
// 钱包基础抽象类
abstract class BaseWallet {
  abstract connect(): Promise<AccountInfo>;
  abstract switchChain(chainId: number): Promise<void>;
}

// MetaMask 实现
class MetaMaskWallet extends BaseWallet {
  // 实现连接逻辑...
}

// Coinbase 实现 
class CoinBaseWallet extends BaseWallet {
  // 实现SDK集成...
}

// 移动钱包APP实现
class MobileWallet extends BaseWallet {
  // 处理DeepLink逻辑...
}
```

### 2 ▫️ 状态管理
```typescript:/src/web3-wallet/context.tsx
const Web3Context = createContext<{
  account: string;
  chainId: number;
  balance: string;
  switchNetwork: (chainId: number) => void;
}>(null!);

// 网络切换处理器
const handleNetworkChanged = (provider: any) => {
  provider.on('chainChanged', (chainId: string) => {
    store.dispatch({ type: 'UPDATE_CHAIN', chainId });
  });
}
```

### 3 ▫️ 安全设计
```typescript:/src/web3-wallet/auth.ts
async function signLogin() {
  const nonce = await generateServerNonce();
  const signature = await wallet.signMessage(nonce);
  
  // 验证签名有效性
  const isValid = verifySignature({
    message: nonce,
    signature,
    address: currentAccount
  });
  
  // 生成防篡改的JWT
  return createJWT(signature); 
}
```

### 4 ▫️ UI 集成
```typescript:/src/web3-wallet/components/ConnectButton.tsx
function ConnectButton() {
  const { status, error } = useWallet();
  
  return (
    <div className="wallet-connector">
      {status === 'connecting' && <Spinner />}
      {error && <ErrorModal message={error.message} />}
      <HistoryPanel />
    </div>
  );
}

// Next.js 集成示例
export const withAuth = (Page: NextPage) => {
  return (props: any) => {
    const { account } = useWeb3();
    return account ? <Page {...props} /> : <ConnectButton />;
  }
}
```

```typescript:/src/web3-wallet/index.d.ts
declare module '@web3-wallet/core' {
  export interface AccountInfo {
    address: string;
    chainId: number;
    ens?: string;
  }
}
```

技术要点：
1. **模块化架构**：采用UMD + TypeScript声明文件
2. **状态同步**：通过EventEmitter实现多Tab状态同步
3. **安全层**：实现nonce签名验证和JWT自动续期
4. **错误边界**：统一处理钱包超时/用户拒绝等异常场景
5. **响应式设计**：内置移动端H5钱包的DeepLink处理
